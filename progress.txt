================================================================================
LAPRDUS TTS - PROGRESS LOG
================================================================================

================================================================================
2026-02-19: Android - Accessibility re-audit, SliderSettingItem fix
================================================================================

SUMMARY: Full accessibility re-audit of all 4 Compose UI screens against 18
TalkBack rules. Found 1 violation in SettingsScreen.kt and fixed it. All string
resources verified across 3 locales - no missing keys.

FILES MODIFIED:
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/SettingsScreen.kt

DETAILED CHANGES:

--- SettingsScreen.kt ---
[RULE 1] SliderSettingItem: Added missing `isTraversalGroup = true` as first
         property inside `semantics(mergeDescendants = true)` block on the
         Slider composable. Required for proper TalkBack swipe navigation
         grouping. Affects all 6 sliders (rate, pitch, volume, sentence/comma/
         newline pauses).

FILES AUDITED (no changes needed):
- MainScreen.kt: All 18 rules pass
- DictionaryListScreen.kt: All 18 rules pass
- DictionaryEditScreen.kt: All 18 rules pass
- String resources: All 3 locales (values, values-hr, values-sr) have matching keys

BUILD STATUS: assembleDebug BUILD SUCCESSFUL (10s)
COMMIT: cf376b2 pushed to main

================================================================================
2026-02-19: Android - Fix dict entry double TalkBack, fix build skill
================================================================================

SUMMARY: Fixed TalkBack announcing dictionary entries twice, fixed build-android
skill to use ./gradlew instead of cmd.exe (cross-platform), enabled parallel builds.

FILES MODIFIED:
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/DictionaryListScreen.kt
- .claude/skills/build-android/SKILL.md
- android/gradle.properties

DETAILED CHANGES:

--- DictionaryListScreen.kt ---
[RULE 2] DictionaryEntryItem: Added Modifier.clearAndSetSemantics {} to both
         Text composables in headlineContent and supportingContent. The parent
         ListItem already uses mergeDescendants=true with explicit contentDescription,
         so children must clear their semantics to prevent duplicate TalkBack
         announcements.

--- build-android skill ---
[FIX] Replaced cmd.exe /c wrapper with ./gradlew directly. The cmd.exe approach
      caused build output to not flow back to Git Bash, making builds appear to hang.
[FIX] Added uname-based platform detection for JAVA_HOME and ADB paths:
      - Windows (MINGW/MSYS): /c/Program Files/Android/Android Studio/jbr
      - Linux: JAVA_HOME env var or /usr/lib/jvm/java-17-openjdk-amd64 fallback
[FIX] ADB install section now detects platform for correct binary path.

--- gradle.properties ---
[PERF] Enabled org.gradle.parallel=true (was commented out) for faster builds.

BUILD STATUS: assembleDebug SUCCESSFUL (8 seconds)
APK installed on physical device (R3CT30GYXHM), TalkBack tested OK.

================================================================================
2026-02-19: Android - Accessibility re-audit (18-rule scan)
================================================================================

SUMMARY: Full accessibility audit of all 4 Compose UI screens against 18 rules.
Only 1 issue found - codebase was already in excellent shape from prior audits.

FILES MODIFIED:
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/DictionaryListScreen.kt

CHANGES:
- DictionaryEntryItem: Added `mergeDescendants = true` and `isTraversalGroup = true`
  to ListItem semantics. Previously used plain `.semantics { contentDescription = ... }`
  which left headline/supporting Text as separate TalkBack-focusable nodes, causing
  potential duplicate announcements when swiping through dictionary entries.
- SliderSettingItem: Removed manual slider semantics from parent Column. Instead, let
  the Slider composable keep its native SeekBar accessibility (className, role, range
  info, setProgress) which TalkBack needs to announce "Slider" role and "Use volume
  keys to adjust" hint. Added `semantics(mergeDescendants = true)` on the Slider with
  contentDescription (label) and stateDescription (formatted value like "1.0x").
  Visual text Row hidden via clearAndSetSemantics. Previous approach of manually
  setting progressBarRangeInfo/setProgress on a Column created a generic View node
  that TalkBack didn't recognize as an interactive slider.
  Affects all 6 sliders: speech rate, pitch, volume, sentence/comma/newline pauses.

STRING RESOURCES: All 3 locale files (values, values-hr, values-sr) verified -
no missing keys. No new strings needed.

BUILD STATUS: assembleDebug SUCCESSFUL

================================================================================
2026-02-19: Android - Fix buttons unresponsive without TalkBack
================================================================================

SUMMARY: Fixed critical bug where all Button/OutlinedButton composables were
unresponsive when TalkBack was OFF. Root cause: accessibility pattern used
Row(clickable) wrapping Button(onClick = {empty}), causing Button to consume
touch events with empty handler. Fix: pass real onClick to inner Button.

FILES MODIFIED:
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/MainScreen.kt
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/SettingsScreen.kt

DETAILED CHANGES:

--- MainScreen.kt ---
[FIX] AccessibleButton (line 325): Changed Button onClick from { } to onClick
      Fixes: Speak/Stop button now works without TalkBack
[FIX] AccessibleOutlinedButton (line 373): Changed OutlinedButton onClick from { } to onClick
      Fixes: Laprdus Settings and Android TTS Settings buttons now work without TalkBack

--- SettingsScreen.kt ---
[FIX] RestoreDefaultButton (line 680): Changed Button onClick from { } to onClick
      Fixes: Restore Default Speed/Pitch/Volume buttons now work without TalkBack

BUILD STATUS:
- Android debug APK: BUILD SUCCESSFUL
- APK installed on physical device (R3CT30GYXHM)

NOTES:
- TalkBack behavior is preserved (Row's accessibility action still works)
- No double invocation: inner Button consumes touch, Row's clickable doesn't fire
- Other settings components (Switch, Slider, Dropdown, Navigation) were verified
  as unaffected since their inner elements either don't consume clicks or have
  real click handlers
- App icon replaced with custom Laprdus branding (see below)

================================================================================
2026-02-19: Android - Replace app icon with custom Laprdus branding
================================================================================

SUMMARY: Replaced default Android Studio bugdroid icon with custom "LAPRDUS"
text icon. Processed source PNG (1024x500) to generate properly-sized icons
for all screen densities, with adaptive icon safe zone padding.

FILES MODIFIED:
- android/app/src/main/res/drawable/ic_launcher_background.xml (solid white)
- android/app/src/main/res/drawable-{mdpi,hdpi,xhdpi,xxhdpi,xxxhdpi}/ic_launcher_foreground.png (NEW)
- android/app/src/main/res/mipmap-{mdpi,hdpi,xhdpi,xxhdpi,xxxhdpi}/ic_launcher.png (NEW)
- android/app/src/main/res/mipmap-{mdpi,hdpi,xhdpi,xxhdpi,xxxhdpi}/ic_launcher_round.png (NEW)

FILES DELETED:
- android/app/src/main/res/drawable/ic_launcher_foreground.xml (old bugdroid vector)
- android/app/src/main/res/mipmap-*/ic_launcher.webp (old bugdroid bitmaps)
- android/app/src/main/res/mipmap-*/ic_launcher_round.webp (old bugdroid bitmaps)

DETAILED CHANGES:
- Cropped source PNG to text area, centered in square canvas
- Created transparent-bg foreground (luminance->alpha for smooth anti-aliasing)
- Padded foreground for adaptive icon safe zone (66dp content in 108dp canvas)
- Generated density-specific foreground PNGs (108-432px)
- Generated legacy mipmap PNGs for pre-API 26 (48-192px)
- Simplified background from green grid to solid white vector
- Adaptive icon XML unchanged (already references correct drawables)
- Monochrome/themed icon layer works correctly (text alpha -> theme color)

BUILD STATUS:
- Android debug APK: BUILD SUCCESSFUL
- APK installed on physical device (R3CT30GYXHM)

================================================================================
2026-02-19: Android Accessibility Audit & Fix
================================================================================

SUMMARY: Scanned all Compose UI files and fixed accessibility violations against
18 TalkBack rules. All fixes use native Compose Role.* constants and proper
semantic patterns for optimal screen reader experience.

FILES MODIFIED:
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/MainScreen.kt
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/SettingsScreen.kt
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/DictionaryListScreen.kt
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/DictionaryEditScreen.kt
- android/app/src/main/res/values/strings.xml
- android/app/src/main/res/values-hr/strings.xml
- android/app/src/main/res/values-sr/strings.xml

DETAILED CHANGES:

--- MainScreen.kt ---
[RULE 1] Added isTraversalGroup = true to DefaultTtsDialog checkbox,
         AccessibleButton, AccessibleOutlinedButton merged semantics blocks.
[RULE 3] Replaced custom cd_button string with native Role.Button via
         .clickable(role = Role.Button). Removed buttonRole parameter from
         AccessibleButton and AccessibleOutlinedButton functions.
[RULE 8] Added onClickLabel = description to button clickables so TalkBack
         announces what happens on activation.
[RULE 9] Added Modifier.semantics { heading() } to TopAppBar title for
         TalkBack heading navigation.
[RULE 13] Reordered DefaultTtsDialog checkbox modifiers: .semantics() now
          comes before .toggleable() in the modifier chain.

--- SettingsScreen.kt ---
[RULE 3] Removed all custom role strings (cd_switch, cd_slider, cd_dropdown,
         cd_button). Replaced with native Role.Switch, Role.Button,
         Role.DropdownList via Compose Role.* constants.
[RULE 5] SwitchSettingItem: Changed from .clickable{} to
         .toggleable(value, onValueChange, role = Role.Switch) for native
         switch role announcement and automatic On/Off state.
[RULE 6] VoiceSettingItem: Added .clickable(role = Role.DropdownList,
         onClickLabel = dropdownDesc). Set contentDescription = label,
         stateDescription = selectedVoiceName.
[RULE 8] Added onClickLabel to RestoreDefaultButton and NavigationSettingItem.
[RULE 18] SliderSettingItem: Removed custom cd_slider role string. Changed to
          contentDescription = title, stateDescription = "$title. $valueLabel"
          per slider pattern.

--- DictionaryListScreen.kt ---
[RULE 6] DictionaryTypeSelector: Added merged semantics with isTraversalGroup,
         contentDescription, stateDescription. Added .clickable(role =
         Role.DropdownList). Added clearAndSetSemantics on Text label,
         ExposedDropdownMenuBox, and OutlinedTextField children.
[RULE 8] DictionaryEntryItem: Added onClickLabel = actionLabel to clickable.
[RULE 9] Added heading() semantics to action menu dialog title and delete
         confirmation dialog title.

--- DictionaryEditScreen.kt ---
[RULE 1] Added isTraversalGroup = true to both checkbox merged semantics.
[RULE 3/4] Both checkboxes (case sensitive, whole word): Replaced .clickable{}
           with .toggleable(value, onValueChange, role = Role.Checkbox).
           Removed custom cd_checkbox and cd_state_on/cd_state_off strings.
           Set contentDescription = label.
[RULE 9] Added heading() semantics to delete confirmation dialog title.
[RULE 13] Reordered modifiers: .semantics() before .toggleable() on both
          checkboxes.

--- String Resources (all 3 locales) ---
Removed 7 unused custom accessibility strings from values/strings.xml,
values-hr/strings.xml, and values-sr/strings.xml:
  - cd_switch (Switch / Prekidac / Prekidac)
  - cd_slider (Slider / Klizac / Klizac)
  - cd_dropdown (Dropdown / Padajuci popis / Padajuca lista)
  - cd_checkbox (Checkbox / Potvrdni okvir / Polje za potvrdu)
  - cd_button (Button / Gumb / Dugme)
  - cd_state_on (On / Ukljuceno / Ukljuceno)
  - cd_state_off (Off / Iskljuceno / Iskljuceno)

IMPORT CLEANUP:
- MainScreen.kt: Added isTraversalGroup import, removed unused stateDescription
- SettingsScreen.kt: Added Role and toggleable imports
- DictionaryListScreen.kt: Added Role, clearAndSetSemantics, isTraversalGroup,
  stateDescription imports
- DictionaryEditScreen.kt: Added Role, isTraversalGroup, toggleable imports.
  Removed unused clickable and stateDescription imports.

BUILD STATUS: Android debug APK builds successfully (no errors, only
pre-existing warning about always-true condition in DictionaryEditScreen.kt:102).

TESTING: No device was connected at time of build. Manual TalkBack testing
required to verify announcement order and behavior.

================================================================================
2026-02-19: Android Accessibility Follow-up Fix
================================================================================

SUMMARY: Follow-up accessibility audit found 2 remaining issues and fixed them.
The codebase was already in excellent shape from the prior audit.

FILES MODIFIED:
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/SettingsScreen.kt
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/DictionaryListScreen.kt
- android/app/src/main/res/values/strings.xml
- android/app/src/main/res/values-hr/strings.xml
- android/app/src/main/res/values-sr/strings.xml

DETAILED CHANGES:

--- SettingsScreen.kt ---
[RULE 9] Added Modifier.semantics { heading() } to Settings TopAppBar title.
         Previously the MainScreen title had heading() but SettingsScreen did not.

--- DictionaryListScreen.kt ---
[RULE 8] Added onClickLabel to DictionaryTypeSelector's .clickable() so TalkBack
         announces "Double-tap to select dictionary type" instead of generic
         "Double-tap to activate".

--- String Resources (all 3 locales) ---
Added new string cd_dict_type_dropdown_desc:
  - English: "Select dictionary type"
  - Croatian: "Odabir vrste rječnika"
  - Serbian: "Izbor vrste rečnika"

BUILD STATUS: Android debug APK builds successfully (commit a1ee637, pushed).

================================================================================
2026-02-19: Android Accessibility Re-Audit (Clean Pass)
================================================================================

SUMMARY: Full accessibility re-audit of all 4 Compose UI files against all 18
TalkBack rules. Zero violations found. The codebase is fully compliant.

FILES AUDITED (no changes needed):
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/SettingsScreen.kt
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/MainScreen.kt
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/DictionaryListScreen.kt
- android/app/src/main/java/com/hrvojekatic/laprdus/ui/screens/DictionaryEditScreen.kt
- android/app/src/main/res/values/strings.xml
- android/app/src/main/res/values-hr/strings.xml
- android/app/src/main/res/values-sr/strings.xml

AUDIT RESULTS:
- Rule 1 (Semantic Merging): All 11 mergeDescendants blocks have isTraversalGroup = true as first property
- Rule 2 (Clear Child Semantics): All children in merged containers use clearAndSetSemantics {}
- Rule 3 (Native Roles): Role.Button, Role.Switch, Role.Checkbox, Role.DropdownList used throughout
- Rule 4 (Checkbox Pattern): Both DictionaryEditScreen checkboxes + DefaultTtsDialog checkbox correct
- Rule 5 (Switch Pattern): SwitchSettingItem uses toggleable(role = Role.Switch) correctly
- Rule 6 (Dropdown Pattern): VoiceSettingItem and DictionaryTypeSelector correct
- Rule 7 (Content Descriptions): All icons have proper contentDescription (null for decorative)
- Rule 8 (Click Labels): onClickLabel provided on all clickable composables
- Rule 9 (Headings): All screen titles, category headers, dialog titles marked as heading()
- Rule 10 (Live Regions): Error display uses Assertive, dialog message uses Polite
- Rule 11 (Touch Targets): All interactive elements meet 48dp minimum
- Rule 13 (State Descriptions): Provided on sliders, dropdowns, navigation items
- Rule 14 (Localization): All accessibility strings exist in all 3 locales (en, hr, sr)
- Rule 15 (Decorative Elements): Properly handled with null contentDescription or clearAndSetSemantics
- Rule 18 (Slider Pattern): progressBarRangeInfo and setProgress correctly implemented

BUILD STATUS: Android debug APK builds successfully (BUILD SUCCESSFUL, 0 errors).
